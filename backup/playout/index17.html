<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <title>T Play Live TV</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.compiled.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #e50914;
      --secondary-color: #b81d24;
      --dark-bg: #141414;
      --medium-bg: #222222;
      --light-bg: #333333;
      --text-color: #ffffff;
      --text-secondary: #e5e5e5;
      --text-muted: #777777;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      background: var(--dark-bg);
      color: var(--text-color);
      font-family: 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
      height: 100vh;
      overflow: hidden;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    #app-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /* Header Styles */
    header {
      background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      z-index: 100;
    }

    .logo {
      font-size: 20px;
      font-weight: bold;
      color: var(--primary-color);
    }

    .header-actions {
      display: flex;
      gap: 15px;
    }

    .header-icon {
      color: var(--text-color);
      font-size: 20px;
    }

    /* Video Player Area */
    #video-container {
      position: relative;
      width: 100%;
      flex-grow: 1;
      background: #000;
    }

    #video {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .video-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.7);
      z-index: 10;
      opacity: 0;
      transition: opacity 0.3s;
    }

    #video-container:hover .video-overlay {
      opacity: 1;
    }

    .channel-info-display {
      text-align: center;
      margin-bottom: 20px;
    }

    .channel-logo {
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin-bottom: 10px;
      border-radius: 8px;
    }

    .channel-name {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .channel-category {
      font-size: 14px;
      color: var(--text-muted);
    }

    .player-controls {
      display: flex;
      gap: 30px;
      margin-top: 20px;
    }

    .control-button {
      background: rgba(255,255,255,0.1);
      border: none;
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .control-button:active {
      transform: scale(0.95);
      background: rgba(255,255,255,0.2);
    }

    .play-pause-btn {
      width: 60px;
      height: 60px;
      font-size: 24px;
      background: var(--primary-color);
    }

    /* Channel List */
    #channel-list-container {
      height: 40vh;
      background: var(--dark-bg);
      border-top: 1px solid var(--medium-bg);
      overflow: hidden;
      position: relative;
    }

    .channel-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: var(--medium-bg);
      position: sticky;
      top: 0;
      z-index: 5;
    }

    .channel-list-title {
      font-size: 16px;
      font-weight: bold;
    }

    .category-filter {
      display: flex;
      overflow-x: auto;
      padding: 8px 16px;
      gap: 10px;
      background: var(--medium-bg);
      scrollbar-width: none;
    }

    .category-filter::-webkit-scrollbar {
      display: none;
    }

    .category-tag {
      background: var(--light-bg);
      color: var(--text-secondary);
      border: none;
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 12px;
      white-space: nowrap;
      cursor: pointer;
      transition: all 0.2s;
    }

    .category-tag.active {
      background: var(--primary-color);
      color: white;
    }

    #channel-list {
      height: calc(100% - 90px);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .channel-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      border-bottom: 1px solid var(--medium-bg);
      transition: background 0.2s;
    }

    .channel-item.active {
      background: rgba(229, 9, 20, 0.1);
    }

    .channel-item:active {
      background: var(--light-bg);
    }

    .channel-logo-small {
      width: 40px;
      height: 40px;
      object-fit: contain;
      margin-right: 12px;
      border-radius: 6px;
    }

    .channel-info {
      flex: 1;
    }

    .channel-title {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 2px;
    }

    .channel-category-small {
      font-size: 12px;
      color: var(--text-muted);
    }

    .play-icon {
      color: var(--primary-color);
      font-size: 16px;
    }

    /* Loading Indicator */
    .loading-spinner {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 20;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Error Message */
    .error-message {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      z-index: 20;
      max-width: 80%;
    }

    .error-message i {
      font-size: 30px;
      color: var(--primary-color);
      margin-bottom: 10px;
    }

    .error-title {
      font-size: 16px;
      margin-bottom: 5px;
    }

    .error-details {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 15px;
    }

    .retry-button {
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
    }

    /* Responsive Adjustments */
    @media (min-width: 768px) {
      #app-container {
        flex-direction: row;
      }
      
      #video-container {
        height: 100vh;
        width: 70vw;
      }
      
      #channel-list-container {
        height: 100vh;
        width: 30vw;
        border-top: none;
        border-left: 1px solid var(--medium-bg);
      }
    }

    /* Hide native video controls on mobile */
    video::-webkit-media-controls {
      display: none !important;
    }
  </style>
</head>
<body>
  <div id="app-container">
    <div id="video-container">
      <video id="video" playsinline autoplay></video>
      
      <div class="video-overlay">
        <div class="channel-info-display">
          <img id="current-channel-logo" class="channel-logo" src="" alt="Channel Logo">
          <div id="current-channel-name" class="channel-name"></div>
          <div id="current-channel-category" class="channel-category"></div>
        </div>
        
        <div class="player-controls">
          <button class="control-button" id="rewind-btn"><i class="fas fa-backward"></i></button>
          <button class="control-button play-pause-btn" id="play-pause-btn"><i class="fas fa-pause"></i></button>
          <button class="control-button" id="forward-btn"><i class="fas fa-forward"></i></button>
        </div>
      </div>
      
      <div class="loading-spinner" id="loading-spinner">
        <div class="spinner"></div>
      </div>
      
      <div class="error-message" id="error-message">
        <i class="fas fa-exclamation-triangle"></i>
        <div class="error-title">Playback Error</div>
        <div class="error-details" id="error-details"></div>
        <button class="retry-button" id="retry-button">Retry</button>
      </div>
    </div>
    
    <div id="channel-list-container">
      <div class="channel-list-header">
        <div class="channel-list-title">Channels</div>
        <div class="header-actions">
          <button class="header-icon" id="search-btn"><i class="fas fa-search"></i></button>
          <button class="header-icon" id="favorites-btn"><i class="fas fa-heart"></i></button>
        </div>
      </div>
      
      <div class="category-filter" id="category-filter">
        <!-- Categories will be injected here -->
      </div>
      
      <div id="channel-list">
        <!-- Channels will be injected here -->
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // DOM Elements
      const video = document.getElementById('video');
      const channelList = document.getElementById('channel-list');
      const categoryFilter = document.getElementById('category-filter');
      const loadingSpinner = document.getElementById('loading-spinner');
      const errorMessage = document.getElementById('error-message');
      const errorDetails = document.getElementById('error-details');
      const retryButton = document.getElementById('retry-button');
      const currentChannelLogo = document.getElementById('current-channel-logo');
      const currentChannelName = document.getElementById('current-channel-name');
      const currentChannelCategory = document.getElementById('current-channel-category');
      const playPauseBtn = document.getElementById('play-pause-btn');
      const rewindBtn = document.getElementById('rewind-btn');
      const forwardBtn = document.getElementById('forward-btn');
      const searchBtn = document.getElementById('search-btn');
      const favoritesBtn = document.getElementById('favorites-btn');
      const videoOverlay = document.querySelector('.video-overlay');
      
      // Initialize Shaka Player
      const player = new shaka.Player(video);
      let currentChannel = null;
      let retryChannel = null;
      
      // Channel Data
      const channels = [
        {
          id: 'sangeet-bangla',
          name: "Sangeet Bangla",
          category: "Indian Bangla",
          logo: "https://upload.wikimedia.org/wikipedia/en/3/3a/Star_Jalsha_logo.png",
          url: "https://cdn-4.pishow.tv/live/1143/master.m3u8",
          drm: null,
          favorite: false
        },
        {
          id: 'zee-bangla',
          name: "Zee Bangla",
          category: "Indian Bangla",
          logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/Zee_Bangla.svg/200px-Zee_Bangla.svg.png",
          url: "https://d1g8wgjurz8via.cloudfront.net/bpk-tv/Zeebangla/default/manifest.mpd",
          drm: {
            keys: [{ kid: "1df83e058b864da896c9288eef63b113", key: "fc32f26239054b56aab48225305598fe" }]
          },
          favorite: true
        },
        {
          id: 'tplay-music',
          name: "T Play Music",
          category: "Indian Bangla",
          logo: "https://upload.wikimedia.org/wikipedia/en/4/4e/Sony_Aath.png",
          url: "https://cloudfrontnet.vercel.app/tplay/playout/209592/master.m3u8",
          drm: null,
          favorite: false
        },
        {
          id: 'enterr-10',
          name: "Enterr 10 Bangla",
          category: "Indian Bangla",
          logo: "https://upload.wikimedia.org/wikipedia/en/thumb/0/06/Enterr10_Bangla_logo.jpeg/200px-Enterr10_Bangla_logo.jpeg",
          url: "https://example.com/enterr10bangla.mpd",
          drm: null,
          favorite: false
        },
        {
          id: 'star-jalsha',
          name: "Star Jalsha",
          category: "Indian Bangla",
          logo: "https://upload.wikimedia.org/wikipedia/en/3/3a/Star_Jalsha_logo.png",
          url: "https://example.com/starjalsha.m3u8",
          drm: null,
          favorite: true
        },
        {
          id: 'colors-bangla',
          name: "Colors Bangla",
          category: "Indian Bangla",
          logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/73/Colors_Bangla_logo.svg/200px-Colors_Bangla_logo.svg.png",
          url: "https://example.com/colorsbangla.m3u8",
          drm: null,
          favorite: false
        }
      ];
      
      // Get unique categories
      const categories = [...new Set(channels.map(channel => channel.category))];
      
      // Initialize the app
      function initApp() {
        renderCategories();
        renderChannels();
        setupEventListeners();
        
        // Try to load the first channel by default
        if (channels.length > 0) {
          loadChannel(channels[0]);
        }
      }
      
      // Render category filters
      function renderCategories() {
        categoryFilter.innerHTML = '';
        
        // Add "All" option
        const allTag = document.createElement('button');
        allTag.className = 'category-tag active';
        allTag.textContent = 'All';
        allTag.dataset.category = 'all';
        allTag.addEventListener('click', filterChannels);
        categoryFilter.appendChild(allTag);
        
        // Add other categories
        categories.forEach(category => {
          const tag = document.createElement('button');
          tag.className = 'category-tag';
          tag.textContent = category;
          tag.dataset.category = category;
          tag.addEventListener('click', filterChannels);
          categoryFilter.appendChild(tag);
        });
      }
      
      // Filter channels by category
      function filterChannels(e) {
        const category = e.currentTarget.dataset.category;
        
        // Update active state
        document.querySelectorAll('.category-tag').forEach(tag => {
          tag.classList.remove('active');
        });
        e.currentTarget.classList.add('active');
        
        // Filter channels
        if (category === 'all') {
          renderChannels();
        } else {
          const filteredChannels = channels.filter(ch => ch.category === category);
          renderChannels(filteredChannels);
        }
      }
      
      // Render channel list
      function renderChannels(channelsToRender = channels) {
        channelList.innerHTML = '';
        
        channelsToRender.forEach(channel => {
          const channelItem = document.createElement('div');
          channelItem.className = 'channel-item';
          if (currentChannel && channel.id === currentChannel.id) {
            channelItem.classList.add('active');
          }
          channelItem.dataset.channelId = channel.id;
          channelItem.innerHTML = `
            <img src="${channel.logo}" alt="${channel.name}" class="channel-logo-small" onerror="this.src='https://via.placeholder.com/40?text=TV'">
            <div class="channel-info">
              <div class="channel-title">${channel.name}</div>
              <div class="channel-category-small">${channel.category}</div>
            </div>
            <i class="fas ${channel.favorite ? 'fa-heart' : 'fa-play'} ${channel.favorite ? '' : 'play-icon'}"></i>
          `;
          channelItem.addEventListener('click', () => loadChannel(channel));
          channelList.appendChild(channelItem);
        });
      }
      
      // Load a channel
      async function loadChannel(channel) {
        currentChannel = channel;
        retryChannel = channel;
        
        // Update UI
        updateCurrentChannelInfo();
        highlightCurrentChannel();
        showLoading();
        hideError();
        
        try {
          await player.unload();
          
          if (channel.drm) {
            const keys = {};
            channel.drm.keys.forEach(k => keys[k.kid] = k.key);
            player.configure({
              drm: {
                clearKeys: keys
              }
            });
          } else {
            player.configure({ drm: { clearKeys: {} } });
          }
          
          await player.load(channel.url);
          hideLoading();
          
          // Auto-play on mobile devices
          if (video.paused) {
            video.play().catch(e => {
              console.log('Autoplay prevented:', e);
            });
          }
          
          console.log('Now playing:', channel.name);
        } catch (error) {
          console.error('Playback error:', error);
          showError(error);
        }
      }
      
      // Update current channel info display
      function updateCurrentChannelInfo() {
        currentChannelLogo.src = currentChannel.logo;
        currentChannelLogo.onerror = () => {
          currentChannelLogo.src = 'https://via.placeholder.com/80?text=TV';
        };
        currentChannelName.textContent = currentChannel.name;
        currentChannelCategory.textContent = currentChannel.category;
      }
      
      // Highlight current channel in list
      function highlightCurrentChannel() {
        document.querySelectorAll('.channel-item').forEach(item => {
          item.classList.remove('active');
          if (item.dataset.channelId === currentChannel.id) {
            item.classList.add('active');
            // Scroll to the channel in the list
            item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          }
        });
      }
      
      // Show loading spinner
      function showLoading() {
        loadingSpinner.style.display = 'block';
      }
      
      // Hide loading spinner
      function hideLoading() {
        loadingSpinner.style.display = 'none';
      }
      
      // Show error message
      function showError(error) {
        hideLoading();
        errorDetails.textContent = error.message || 'Failed to load channel';
        errorMessage.style.display = 'block';
      }
      
      // Hide error message
      function hideError() {
        errorMessage.style.display = 'none';
      }
      
      // Setup event listeners
      function setupEventListeners() {
        // Video controls
        playPauseBtn.addEventListener('click', togglePlayPause);
        rewindBtn.addEventListener('click', () => seek(-10));
        forwardBtn.addEventListener('click', () => seek(10));
        
        // Video events
        video.addEventListener('play', updatePlayPauseButton);
        video.addEventListener('pause', updatePlayPauseButton);
        video.addEventListener('waiting', showLoading);
        video.addEventListener('playing', hideLoading);
        video.addEventListener('error', () => {
          showError({ message: 'Video playback error' });
        });
        
        // Retry button
        retryButton.addEventListener('click', () => {
          if (retryChannel) {
            loadChannel(retryChannel);
          }
        });
        
        // Search and favorites buttons
        searchBtn.addEventListener('click', () => {
          alert('Search functionality will be implemented');
        });
        
        favoritesBtn.addEventListener('click', () => {
          const favoriteChannels = channels.filter(ch => ch.favorite);
          renderChannels(favoriteChannels);
        });
        
        // Touch events for mobile controls
        let touchStartX = 0;
        video.addEventListener('touchstart', (e) => {
          touchStartX = e.touches[0].clientX;
        });
        
        video.addEventListener('touchend', (e) => {
          const touchEndX = e.changedTouches[0].clientX;
          const diff = touchStartX - touchEndX;
          
          if (Math.abs(diff) > 50) { // Minimum swipe distance
            if (diff > 0) {
              // Swipe left - next channel
              const currentIndex = channels.findIndex(ch => ch.id === currentChannel.id);
              if (currentIndex < channels.length - 1) {
                loadChannel(channels[currentIndex + 1]);
              }
            } else {
              // Swipe right - previous channel
              const currentIndex = channels.findIndex(ch => ch.id === currentChannel.id);
              if (currentIndex > 0) {
                loadChannel(channels[currentIndex - 1]);
              }
            }
          }
        });
      }
      
      // Toggle play/pause
      function togglePlayPause() {
        if (video.paused) {
          video.play().catch(e => console.log('Play failed:', e));
        } else {
          video.pause();
        }
      }
      
      // Update play/pause button
      function updatePlayPauseButton() {
        playPauseBtn.innerHTML = video.paused ? '<i class="fas fa-play"></i>' : '<i class="fas fa-pause"></i>';
      }
      
      // Seek in video
      function seek(seconds) {
        video.currentTime += seconds;
      }
      
      // Initialize Shaka Player and app
      shaka.polyfill.installAll();
      if (shaka.Player.isBrowserSupported()) {
        initApp();
      } else {
        showError({ message: 'Shaka Player is not supported in this browser' });
      }
      
      // Handle offline detection
      window.addEventListener('offline', () => {
        showError({ message: 'You are offline. Please check your internet connection.' });
      });
      
      window.addEventListener('online', () => {
        if (retryChannel) {
          loadChannel(retryChannel);
        }
      });
    });
  </script>
</body>
</html>
