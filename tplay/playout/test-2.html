<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T Play Live TV</title>

<!-- Shaka only for DASH -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.8.5/shaka-player.compiled.min.js"></script>

<style>
  body {margin:0;background:#000;color:#fff;font-family:Poppins,sans-serif;}
  header {background:#e50914;text-align:center;padding:10px;font-size:1.5em;}
  video {width:100%;height:60vh;background:#000;}
  .channels {display:flex;overflow-x:auto;padding:10px;background:#111;gap:10px;}
  .ch {flex:0 0 auto;text-align:center;cursor:pointer;}
  .ch img {width:90px;height:90px;border-radius:12px;object-fit:contain;background:#222;}
  .ch span {display:block;margin-top:5px;font-size:0.9em;}
</style>
</head>

<body>

<header>T Play Live TV</header>
<video id="video" controls autoplay></video>
<div class="channels" id="list"></div>

<script>
const channels = [
  {
    name: "Deewana",
    logo: "https://tplay.live/originals/deewana/deewana.png",
    url: "https://tplay.live/originals/deewana/index.m3u8",
    type: "hls"
  },
  {
    name: "Saregama Music",
    logo: "https://dnuk7lvye3m03.cloudfront.net/runntv/platform/channels/SRGMUS/TV/thumbnail/logo_tv.png",
    url: "https://saregama.cdn.runn.tv/saregama/saregama_master.m3u8",
    type: "hls"
  },
  {
    name: "And TV SD",
    logo: "https://imagesdishtvd2h.whatsonindia.com/dasimages/channel/landscape/360x270/T1CCvaAQ.png",
    url: "https://d1g8wgjurz8via.cloudfront.net/bpk-tv/Andtv/default/manifest.mpd",
    type: "dash",
    license: {
      kid: "26df86eeebb04d7fbc45c948f76e81fd",
      key: "5f3a23f1a73c4c96ababce5fffe7b06b"
    }
  }
];

const list = document.getElementById("list");
const video = document.getElementById("video");
let player = null;

// Show channels ALWAYS — no JS error before this point!
function loadChannelList() {
  channels.forEach(ch => {
    const div = document.createElement("div");
    div.className = "ch";
    div.innerHTML = `<img src="${ch.logo}"><span>${ch.name}</span>`;
    div.onclick = () => playChannel(ch);
    list.appendChild(div);
  });
}

async function playChannel(ch) {
  try {
    // STOP Shaka before loading new channel
    if (player) {
      await player.destroy();
      player = null;
    }

    // HLS → use native player → NO ERROR
    if (ch.type === "hls") {
      video.src = ch.url;
      video.play();
      return;
    }

    // DASH → Use Shaka Player
    if (ch.type === "dash") {
      player = new shaka.Player(video);
      player.configure({
        drm: {
          clearKeys: { [ch.license.kid]: ch.license.key }
        }
      });
      await player.load(ch.url);
      video.play();
    }

  } catch (err) {
    console.error("Playback error:", err);
    alert("Cannot play " + ch.name);
  }
}

loadChannelList(); // SHOW CHANNELS FIRST
</script>

</body>
</html>
