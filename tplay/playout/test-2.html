<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T Play Live TV</title>

<style>
  body {margin:0;background:#000;color:#fff;font-family:Poppins,sans-serif;}
  header{background:#e50914;text-align:center;padding:10px;font-size:1.5em;}
  video{width:100%;height:60vh;background:#000;}
  .channels{display:flex;overflow-x:auto;padding:10px;background:#111;gap:10px;}
  .ch{flex:0 0 auto;text-align:center;cursor:pointer;}
  .ch img{width:90px;height:90px;border-radius:12px;object-fit:contain;background:#222;}
  .ch span{display:block;margin-top:5px;font-size:0.9em;}
</style>
</head>
<body>

<header>T Play Live TV</header>
<video id="video" controls autoplay></video>
<div class="channels" id="list"></div>


<!-- ========================================= -->
<!-- LOAD SHAKA PLAYER WITH FALLBACK LOADER    -->
<!-- ========================================= -->
<script>
function loadShaka() {
  const script = document.createElement("script");
  script.src = "https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.compiled.min.js";
  script.onload = () => {
    console.log("Shaka Player loaded OK");
    initApp();
  };
  script.onerror = () => {
    alert("Shaka Player failed to load. CDN blocked.");
  };
  document.head.appendChild(script);
}

loadShaka();
</script>


<!-- ========================================= -->
<!--        MAIN APP SCRIPT BELOW              -->
<!-- ========================================= -->
<script>
const placeholderLogo = "https://via.placeholder.com/90x90?text=TV";

const channels = [
  {
    name: "App Video 1",
    logo: placeholderLogo,
    url: "go:S2511",
    type: "internal"
  },
  {
    name: "App Video 2",
    logo: placeholderLogo,
    url: "go:S2512",
    type: "internal"
  },
  {
    name: "Deewana",
    logo: placeholderLogo,
    url: "https://tplay.live/originals/deewana/index.m3u8",
    type: "hls"
  },
  {
    name: "Saregama Music",
    logo: "https://dnuk7lvye3m03.cloudfront.net/runntv/platform/channels/SRGMUS/TV/thumbnail/logo_tv.png",
    url: "https://saregama.cdn.runn.tv/saregama/saregama_master.m3u8",
    type: "hls"
  },
  {
    name: "And TV SD",
    logo: "https://imagesdishtvd2h.whatsonindia.com/dasimages/channel/landscape/360x270/T1CCvaAQ.png",
    url: "https://d1g8wgjurz8via.cloudfront.net/bpk-tv/Andtv/default/manifest.mpd",
    type: "dash",
    license: {
      kid: "26df86eeebb04d7fbc45c948f76e81fd",
      key: "5f3a23f1a73c4c96ababce5fffe7b06b"
    }
  },
  {
    name: "Romedy Now",
    logo: "https://d229kpbsb5jevy.cloudfront.net/timesplay/content/common/logos/channel/logos/nchght.jpeg",
    url: "https://times-ott-live.akamaized.net/romedynow_wv_drm/index.mpd",
    type: "dash",
    license: {
      kid: "40f019b86241d23ef075633fd7f1e927",
      key: "058dec845bd340178a388edd104a015e"
    }
  }
];

let player;
const list = document.getElementById("list");
const video = document.getElementById("video");


async function initApp() {
  if (!window.shaka) {
    alert("Shaka not available!");
    return;
  }

  shaka.polyfill.installAll();

  player = new shaka.Player(video);

  // Build channel list UI
  channels.forEach(ch => {
    const div = document.createElement("div");
    div.className = "ch";
    div.innerHTML = `
      <img src="${ch.logo}" onerror="this.src='${placeholderLogo}'">
      <span>${ch.name}</span>
    `;
    div.onclick = () => loadChannel(ch);
    list.appendChild(div);
  });

  // Auto play first channel
  loadChannel(channels[0]);
}


async function loadChannel(ch) {
  try {
    if (ch.type === "internal") {
      window.location.href = ch.url;
      return;
    }

    if (ch.type === "hls") {
      await player.load(ch.url);
    }

    if (ch.type === "dash") {
      player.configure({
        drm: {
          clearKeys: { [ch.license.kid]: ch.license.key }
        }
      });
      await player.load(ch.url);
    }

    video.play();

  } catch (err) {
    console.error(err);
    alert("Cannot play " + ch.name);
  }
}
</script>

</body>
</html>
