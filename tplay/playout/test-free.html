<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T Play Live TV</title>
<link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.8.5/shaka-player.compiled.min.js"></script>
<style>
  body {
    margin: 0;
    font-family: Poppins, sans-serif;
    background-color: #0d0d0d;
    color: white;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  header {
    background: linear-gradient(90deg, #e50914, #221f1f);
    text-align: center;
    padding: 10px;
    font-size: 1.5em;
    font-weight: bold;
    letter-spacing: 1px;
  }

  .player-container {
    position: relative;
    width: 100%;
    background: black;
    flex: 1;
  }

  #video {
    width: 100%;
    height: 100%;
  }

  .channel-list {
    display: flex;
    overflow-x: auto;
    gap: 12px;
    background: #111;
    padding: 10px;
    scroll-behavior: smooth;
  }

  .channel {
    flex: 0 0 auto;
    text-align: center;
    cursor: pointer;
  }

  .channel img {
    width: 80px;
    height: 80px;
    border-radius: 12px;
    object-fit: contain;
    background: #222;
    transition: transform 0.3s;
  }

  .channel:hover img {
    transform: scale(1.05);
  }

  .channel span {
    display: block;
    margin-top: 4px;
    font-size: 0.85em;
  }

  @media (min-width: 768px) {
    .channel img { width: 100px; height: 100px; }
  }
</style>
</head>
<body>

<header>T Play Live TV</header>

<div class="player-container">
  <video id="video" class="video-js vjs-default-skin" controls preload="auto" poster="" autoplay></video>
</div>

<div class="channel-list" id="channelList">
  <!-- Channels will be added dynamically -->
</div>

<script>
const channels = [
  {
    name: "Deewana",
    logo: "https://tplay.live/originals/deewana/deewana.png",
    url: "https://tplay.live/originals/deewana/index.m3u8",
    type: "hls"
  },
  {
    name: "Saregama Music",
    logo: "https://dnuk7lvye3m03.cloudfront.net/runntv/platform/channels/SRGMUS/TV/thumbnail/logo_tv.png",
    url: "https://saregama.cdn.runn.tv/saregama/saregama_master.m3u8",
    type: "hls"
  },
  {
    name: "And TV SD",
    logo: "https://imagesdishtvd2h.whatsonindia.com/dasimages/channel/landscape/360x270/T1CCvaAQ.png",
    url: "https://d1g8wgjurz8via.cloudfront.net/bpk-tv/Andtv/default/manifest.mpd",
    type: "dash",
    license: {
      type: "clearkey",
      keys: [{ kid: "26df86eeebb04d7fbc45c948f76e81fd", key: "5f3a23f1a73c4c96ababce5fffe7b06b" }]
    }
  },
  {
    name: "Movies Now HD",
    logo: "https://d229kpbsb5jevy.cloudfront.net/timesplay/content/common/logos/channel/logos/wthfwe.jpeg",
    url: "https://times-ott-live.akamaized.net/moviesnow_wv_drm/index.mpd",
    type: "dash",
    license: {
      type: "clearkey",
      keys: [{ kid: "40f019b86241d23ef075633fd7f1e927", key: "058dec845bd340178a388edd104a015e" }]
    }
  }
];

const channelList = document.getElementById("channelList");
const videoElement = document.getElementById("video");
const player = videojs(videoElement);

// Build UI dynamically
channels.forEach((ch, i) => {
  const div = document.createElement("div");
  div.className = "channel";
  div.innerHTML = `<img src="${ch.logo}" alt="${ch.name}"><span>${ch.name}</span>`;
  div.addEventListener("click", () => loadChannel(ch));
  channelList.appendChild(div);
});

// Load first channel by default
window.onload = () => loadChannel(channels[0]);

async function loadChannel(channel) {
  player.reset();
  player.pause();

  if (channel.type === "hls") {
    player.src({ src: channel.url, type: "application/x-mpegURL" });
    player.play();
  } else if (channel.type === "dash") {
    // Use Shaka for DASH + clearkey
    videoElement.innerHTML = "";
    const shakaPlayer = new shaka.Player(videoElement);

    if (channel.license && channel.license.type === "clearkey") {
      shakaPlayer.configure({
        drm: {
          clearKeys: Object.fromEntries(
            channel.license.keys.map(k => [k.kid, k.key])
          )
        }
      });
    }

    try {
      await shakaPlayer.load(channel.url);
      videoElement.play();
    } catch (e) {
      alert("Error loading stream: " + channel.name);
      console.error(e);
    }
  }
}
</script>

</body>
</html>
