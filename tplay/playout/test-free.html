<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T Play Live TV Pro</title>

<!-- Shaka Player -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.8.5/shaka-player.ui.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.8.5/controls.min.css"/>

<style>
body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: Poppins, sans-serif;
  display: flex;
  flex-direction: column;
  height: 100vh;
}
header {
  background: linear-gradient(90deg, #e50914, #221f1f);
  text-align: center;
  padding: 10px;
  font-size: 1.6em;
  letter-spacing: 1px;
}
#videoContainer {
  flex: 1;
  position: relative;
  background: black;
}
video {
  width: 100%;
  height: 100%;
  background: black;
}
.channel-list {
  display: flex;
  overflow-x: auto;
  gap: 10px;
  background: #111;
  padding: 10px;
}
.channel {
  flex: 0 0 auto;
  text-align: center;
  cursor: pointer;
}
.channel img {
  width: 90px;
  height: 90px;
  border-radius: 12px;
  object-fit: contain;
  background: #222;
  transition: transform 0.3s;
}
.channel:hover img {
  transform: scale(1.05);
}
.channel span {
  display: block;
  font-size: 0.8em;
  margin-top: 3px;
}
#infoOverlay {
  position: absolute;
  bottom: 10%;
  left: 5%;
  background: rgba(0, 0, 0, 0.6);
  padding: 10px 20px;
  border-radius: 10px;
  font-size: 1.2em;
  display: none;
}
</style>
</head>
<body>

<header>T Play Live TV Pro</header>

<div id="videoContainer">
  <video id="video" autoplay controls></video>
  <div id="infoOverlay"></div>
</div>

<div class="channel-list" id="channelList"></div>

<script>
const channels = [
  {
    name: "Deewana",
    logo: "https://tplay.live/originals/deewana/deewana.png",
    url: "https://tplay.live/originals/deewana/index.m3u8",
    type: "hls"
  },
  {
    name: "Saregama Music",
    logo: "https://dnuk7lvye3m03.cloudfront.net/runntv/platform/channels/SRGMUS/TV/thumbnail/logo_tv.png",
    url: "https://saregama.cdn.runn.tv/saregama/saregama_master.m3u8",
    type: "hls"
  },
  {
    name: "And TV SD",
    logo: "https://imagesdishtvd2h.whatsonindia.com/dasimages/channel/landscape/360x270/T1CCvaAQ.png",
    url: "https://d1g8wgjurz8via.cloudfront.net/bpk-tv/Andtv/default/manifest.mpd",
    type: "dash",
    license: {
      kid: "26df86eeebb04d7fbc45c948f76e81fd",
      key: "5f3a23f1a73c4c96ababce5fffe7b06b"
    }
  },
  {
    name: "Movies Now HD",
    logo: "https://d229kpbsb5jevy.cloudfront.net/timesplay/content/common/logos/channel/logos/wthfwe.jpeg",
    url: "https://times-ott-live.akamaized.net/moviesnow_wv_drm/index.mpd",
    type: "dash",
    license: {
      kid: "40f019b86241d23ef075633fd7f1e927",
      key: "058dec845bd340178a388edd104a015e"
    }
  }
];

const container = document.getElementById('videoContainer');
const video = document.getElementById('video');
const channelList = document.getElementById('channelList');
const infoOverlay = document.getElementById('infoOverlay');

let ui, player, controls, currentIndex = 0;

// Init Shaka Player with UI controls
function initPlayer() {
  shaka.polyfill.installAll();

  if (!shaka.Player.isBrowserSupported()) {
    alert("Browser not supported!");
    return;
  }

  const videoContainer = document.getElementById('videoContainer');
  const video = document.getElementById('video');

  const uiOverlay = shaka.ui.Overlay;
  const config = {
    controlPanelElements: [
      'play_pause', 'mute', 'volume', 'spacer', 'quality', 
      'audio', 'fullscreen', 'picture_in_picture', 'airplay', 'cast', 'rewind', 'fast_forward'
    ],
    enableKeyboardPlaybackControls: true
  };

  ui = new uiOverlay(new shaka.Player(video), videoContainer, config);
  player = ui.getControls().getPlayer();
  controls = ui.getControls();

  loadChannel(channels[0]);
}

// Load selected channel
async function loadChannel(ch) {
  try {
    infoOverlay.innerText = "Now Playing: " + ch.name;
    infoOverlay.style.display = 'block';
    setTimeout(() => infoOverlay.style.display = 'none', 3000);

    if (ch.type === 'hls') {
      await player.load(ch.url);
    } else if (ch.type === 'dash') {
      player.configure({
        drm: {
          clearKeys: { [ch.license.kid]: ch.license.key }
        }
      });
      await player.load(ch.url);
    }
    video.play();
  } catch (err) {
    console.error("Error loading", ch.name, err);
    alert("Cannot play " + ch.name);
  }
}

// Build channel list
channels.forEach((ch, i) => {
  const div = document.createElement('div');
  div.className = 'channel';
  div.innerHTML = `<img src="${ch.logo}"><span>${ch.name}</span>`;
  div.onclick = () => {
    currentIndex = i;
    loadChannel(ch);
  };
  channelList.appendChild(div);
});

// Auto next channel when ended
video.addEventListener('ended', () => {
  currentIndex = (currentIndex + 1) % channels.length;
  loadChannel(channels[currentIndex]);
});

document.addEventListener("DOMContentLoaded", initPlayer);
</script>
</body>
</html>
