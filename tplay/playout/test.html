<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>T Play - Mobile Fixed</title>
  <link href="https://vjs.zencdn.net/7.15.4/video-js.css" rel="stylesheet" />
  <script src="https://vjs.zencdn.net/7.15.4/video.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body { background:#000; color:#fff; margin:0; font-family:Arial, sans-serif; }
    .player-container { position:relative; width:100%; padding-top:56.25%; background:#000; }
    .video-js { position:absolute; top:0; left:0; width:100%; height:100%; }
    .channels { display:flex; flex-wrap:wrap; padding:10px; gap:10px; }
    .channel { background:#111; border:1px solid #333; padding:10px; cursor:pointer; border-radius:6px; flex:1 0 120px; text-align:center; }
    .channel img { width:100%; height:70px; object-fit:contain; }
  </style>
</head>
<body>
  <div class="player-container">
    <!-- Autoplay + muted + playsinline = Mobile safe -->
    <video id="live-tv-player" class="video-js vjs-default-skin" autoplay muted playsinline webkit-playsinline controls></video>
  </div>

  <h3 style="padding:10px;">Live Channels</h3>
  <div class="channels" id="channelList"></div>

<script>
  const player = videojs('live-tv-player', {
    autoplay: 'muted',
    muted: true,
    controls: true,
    preload: 'auto',
    fluid: true,
    playsinline: true,
    responsive: true,
    liveui: true
  });

  const videoEl = player.el().querySelector('video');
  videoEl.setAttribute('playsinline','');
  videoEl.setAttribute('webkit-playsinline','');
  videoEl.setAttribute('muted','');
  videoEl.muted = true;

  const channels = [
    {name:"Oxygen Music",url:"https://cloudfrontnet.vercel.app/tplay/playout/209901/master.m3u8",logo:"https://github.com/tplaylive/stream/blob/main/tplay/playout/209901/Oxygen-Music.jpg?raw=true"},
    {name:"Bengali Beats",url:"https://cloudfrontnet.vercel.app/tplay/playout/209587/master.m3u8",logo:"https://github.com/tplaylive/stream/blob/main/tplay/playout/209587/Bengali-Beats.png?raw=true"},
    {name:"T Series",url:"https://cloudfrontnet.vercel.app/tplay/playout/210427/master.m3u8",logo:"https://github.com/tplaylive/stream/blob/main/tplay/playout/210427/T-Series.jpg?raw=true"},
    {name:"Ilm Tv",url:"https://cloudfrontnet.vercel.app/tplay/playout/209617/master.m3u8",logo:"https://github.com/tplaylive/stream/blob/main/tplay/playout/209617/ilm.jpg?raw=true"}
  ];

  let currentIndex = 0;
  let hls;

  function renderChannels() {
    const list = document.getElementById('channelList');
    list.innerHTML = '';
    channels.forEach((ch, i) => {
      const div = document.createElement('div');
      div.className = 'channel';
      div.innerHTML = `<img src="${ch.logo}" alt="${ch.name}"><p>${ch.name}</p>`;
      div.onclick = ()=> changeChannel(i);
      list.appendChild(div);
    });
  }

  function changeChannel(index) {
    currentIndex = index;
    const channel = channels[index];

    if (hls) { hls.destroy(); }

    // ✅ Desktop/Android: Hls.js
    if (Hls.isSupported()) {
      hls = new Hls();
      hls.loadSource(channel.url);
      hls.attachMedia(videoEl);
      hls.on(Hls.Events.MANIFEST_PARSED, () => {
        player.muted(true);
        player.play().catch(()=>{});
      });
    } 
    // ✅ iOS Safari: Native HLS
    else if (videoEl.canPlayType('application/vnd.apple.mpegurl')) {
      player.src({ src: channel.url, type: 'application/x-mpegURL' });
      player.muted(true);
      player.play().catch(()=>{});
    } 
    else {
      alert('HLS not supported on this browser.');
    }
  }

  // Initial load
  renderChannels();
  changeChannel(0);

  // Fallback unlock on first user tap (in case autoplay is blocked)
  const unlock = () => {
    player.muted(true);
    player.play().catch(()=>{});
    window.removeEventListener('touchend', unlock);
    window.removeEventListener('click', unlock);
  };
  window.addEventListener('touchend', unlock, { once:true });
  window.addEventListener('click', unlock, { once:true });

</script>
</body>
</html>
